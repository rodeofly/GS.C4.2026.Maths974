---
// src/layouts/BasePrintLayout.astro
import '../styles/main.css';
import Navbar from '../components/Navbar.astro';
import SubthemeInfo from '../components/SubthemeInfo.astro';

const { info, title, layoutClass, niveauLabel, indexContent } = Astro.props;
const base = import.meta.env.BASE_URL.replace(/\/$/, '');

// üõ†Ô∏è D√âTECTION FIABLE bas√©e sur l'URL de la page
const path = Astro.url.pathname;
const isRapido = path.includes('/rapidos/');

const rootLabel = isRapido ? 'Rapidos' : 'Guide';
const rootUrl = isRapido ? `${base}/rapidos/` : `${base}/guide/`;

// Slug actuel pour la logique d'affichage
const slug = info?.slug?.replace(/\/index$/, '') || '';
const niveauSlug = slug.split('/')[0];
---
<body class={`layout ${layoutClass}`}>
    <Navbar title={title} />
    
    <header class="layout-header-simple">
      <nav class="breadcrumb no-print" aria-label="Fil d'ariane">
        <ol>
          <li><a href={`${base}/`}>Accueil</a></li>
          
          {/* Affiche "Rapidos" ou "Guide" seulement si on n'est pas d√©j√† √† la racine de la section */}
          {slug !== "" && slug !== "index" && (
            <>
              <li class="separator">/</li>
              <li><a href={rootUrl}>{rootLabel}</a></li>
            </>
          )}
          
          {/* Affiche le Niveau (ex: CM2) seulement si on est dans un sous-dossier ou une fiche */}
          {niveauLabel && niveauSlug && slug !== niveauSlug && (
            <>
              <li class="separator">/</li>
              <li><a href={`${rootUrl}${niveauSlug}/`}>{niveauLabel}</a></li>
            </>
          )}
          
          <li class="separator">/</li>
          <li class="current" aria-current="page">
            {title}
            <SubthemeInfo info={info} Content={indexContent} />
          </li>
        </ol>
      </nav>

      <div class="header-main">
        <h1>{title}</h1>
      </div>
    </header>

    <main class="etiquettes-grid">
      <slot />
    </main>

    <footer>
      <slot name="footer" />
    </footer>
    </body>
</html>

<style>
/* ... Styles inchang√©s ... */
.layout-header-simple { display: flex; flex-direction: column; gap: var(--space-2); margin-bottom: var(--space-6); }
.breadcrumb ol { display: flex; flex-wrap: wrap; align-items: center; list-style: none; padding: 0; margin: 0; font-size: var(--text-sm); color: var(--color-gray-500); }
.breadcrumb a { color: var(--color-gray-600); text-decoration: none; transition: color 0.2s; }
.breadcrumb a:hover { color: var(--color-guide-primary); text-decoration: underline; }
.breadcrumb .separator { margin: 0 var(--space-2); color: var(--color-gray-400); font-size: 0.8em; }
.breadcrumb .current { font-weight: var(--font-bold); color: var(--color-gray-900); display: flex; align-items: center; }
.header-main h1 { margin: 0; font-size: clamp(var(--text-2xl), 4vw, var(--text-4xl)); font-weight: var(--font-black); color: var(--color-guide-primary); line-height: var(--leading-tight); }
@media print { .breadcrumb { display: none; } .layout-header-simple { margin-bottom: var(--space-4); } }
</style>