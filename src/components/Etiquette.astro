---
import QRCode from './QRCode.astro';
import Accordion from './Accordion.astro';

const { entry } = Astro.props;
const fm = entry?.frontmatter ?? {};
const Content = entry?.Content;
const formatRaw = String(fm.format ?? '1').replace('/', '_').replace('.', '_');
const formatClass = `format-${formatRaw}`;
const contenus = Array.isArray(fm.contenus) ? fm.contenus : [];
const erreurs = Array.isArray(fm.erreurs_frequentes) ? fm.erreurs_frequentes : [];
const accordions = Array.isArray(fm.accordeons) ? fm.accordeons : [];
const liens = Array.isArray(fm.liens) ? fm.liens : [];
---
<article class={`etiquette ${formatClass}`} id={fm.id}>
  <header>
    <h2>{fm.title ?? 'Étiquette'}</h2>
    <div class="meta">
      {fm.objectif ? <span><strong>Objectif :</strong> {fm.objectif}</span> : null}
      {fm.sous_theme ? <span>{fm.sous_theme}</span> : null}
    </div>
  </header>
  {contenus.length ? (
    <section>
      <h3>À retenir</h3>
      <ul class="contenus">
        {contenus.map((item) => (
          <li>{item}</li>
        ))}
      </ul>
    </section>
  ) : null}
  {fm.rappel ? (
    <section class="rappel">
      <strong>Rappel :</strong> {fm.rappel}
    </section>
  ) : null}
  {erreurs.length ? (
    <section class="erreurs">
      <strong>Erreurs fréquentes :</strong>
      <ul>
        {erreurs.map((item) => (
          <li>{item}</li>
        ))}
      </ul>
    </section>
  ) : null}
  {Content ? (
    <section class="texte">
      <Content />
    </section>
  ) : null}
  {accordions.length ? (
    <section class="accordion-group">
      {accordions.map((item) => (
        <Accordion titre={item.titre} contenu={item.contenu} />
      ))}
    </section>
  ) : null}
  {liens.map((lien) => (
    <QRCode lien={lien} />
  ))}
</article>
