---
// src/pages/index.astro
import { getCollection } from 'astro:content';
import Navbar from '../components/Navbar.astro';
import '../styles/main.css';
import '../styles/pages/home.css';

// R√©cup√©ration des collections
const guides = await getCollection('guide', ({ id }) => {
  return id.split('/').length === 2 && id.endsWith('index.md');
});
const rapidos = await getCollection('rapidos', ({ id }) => {
  return id.split('/').length === 2 && id.endsWith('index.md');
});

// Tri alphab√©tique
const sortContent = (a, b) => a.data.title.localeCompare(b.data.title);

// R√©cup√©ration de la Base URL (pour GitHub Pages)
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maths974 - Accueil</title>
  <link rel="icon" type="image/svg+xml" href={`${base}/favicon.svg`} />
</head>
<body>
  
  <Navbar title="Accueil" />

  <div class="home-container">
    
    <header class="home-header">
      <h1 class="home-title">Maths974</h1>
      <p class="home-subtitle">Ressources, fiches de r√©vision et exercices rapides pour le coll√®ge et le lyc√©e.</p>
    </header>

    <div class="menu-section">
      <div class="section-title guide-color">
        <span>üìö</span> Guides de Survie
      </div>
      <div class="grid">
        {guides.sort(sortContent).map(g => (
          <a href={`${base}/guide/${g.slug.replace('/index', '')}/`} class="card guide-card">
            
            <div class="card-header-home">
                <h3>{g.data.title}</h3>
                {/* üü¢ Badge Niveau Guide */}
                {g.data.niveau && <span class="badge guide">{g.data.niveau}</span>}
            </div>
            
            <p>{g.data.resume || "Fiches de r√©vision compl√®tes"}</p>
          </a>
        ))}
      </div>
    </div>

    <div class="menu-section">
      <div class="section-title rapido-color">
        <span>‚ö°</span> Rapidos
      </div>
      <div class="grid">
        {rapidos.sort(sortContent).map(r => {
          // On extrait le nom du dossier du slug (ex: "6e" de "6e/index")
          const folderName = r.slug.split('/')[0];
          return (
            <a href={`${base}/rapidos/${folderName}/`} class="card rapido-card">
              <div class="card-header-home">
                <h3>{r.data.title || `Rapidos ${folderName.toUpperCase()}`}</h3>
                {r.data.niveau && <span class="badge rapido">{r.data.niveau}</span>}
              </div>
              <p>{r.data.resume || "S√©ries d'exercices par niveau"}</p>
            </a>
          )
        })}
      </div>
    </div>

  </div>
</body>
</html>

<style>
  /* Styles sp√©cifiques aux cartes de l'accueil */
  
  .card-header-home {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-2);
    gap: 1rem;
  }

  /* On s'assure que le titre ne prend pas toute la place s'il y a un badge */
  .card-header-home h3 {
    margin: 0;
    font-size: var(--text-xl);
    line-height: 1.2;
  }

  .badge {
    font-size: 0.75rem;
    padding: 0.25rem 0.6rem;
    border-radius: 99px;
    font-weight: 700;
    text-transform: uppercase;
    white-space: nowrap; /* Emp√™che le badge de se casser */
    flex-shrink: 0;      /* Emp√™che le badge de r√©tr√©cir */
  }

  /* Couleurs des badges */
  .badge.guide {
    background-color: var(--color-guide-light);
    color: var(--color-guide-primary);
  }

  .badge.rapido {
    background-color: var(--color-rapido-light);
    color: var(--color-rapido-primary);
  }
</style>