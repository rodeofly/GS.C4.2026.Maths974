---
// src/pages/index.astro
import { getCollection } from 'astro:content';
import Navbar from '../components/Navbar.astro';
import '../styles/main.css';
import '../styles/pages/home.css';

// R√©cup√©ration des collections
const guides = await getCollection('guide', ({ id }) => {
  return id.split('/').length === 2 && id.endsWith('index.md');
});
const rapidos = await getCollection('rapidos', ({ id }) => {
  return id.split('/').length === 2 && id.endsWith('index.md');
});

// Tri alphab√©tique
const sortContent = (a, b) => a.data.title.localeCompare(b.data.title);

// üõ†Ô∏è R√âCUP√âRATION DE LA BASE URL (G√®re le /GS.C4.2026.Maths974 automatiquement)
// On retire le slash final s'il existe pour √©viter les doubles //
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maths974 - Accueil</title>
  <link rel="icon" type="image/svg+xml" href={`${base}/favicon.svg`} />
</head>
<body>
  
  <Navbar title="Accueil" />

  <div class="home-container">
    
    <header class="home-header">
      <h1 class="home-title">Maths974</h1>
      <p class="home-subtitle">Ressources, fiches de r√©vision et exercices rapides pour le coll√®ge et le lyc√©e.</p>
    </header>

    <div class="menu-section">
      <div class="section-title guide-color">
        <span>üìö</span> Guides de Survie
      </div>
      <div class="grid">
        {guides.sort(sortContent).map(g => (
          /* üõ†Ô∏è AJOUT DE LA BASE ICI */
          <a href={`${base}/guide/${g.slug.replace('/index', '')}/`} class="card guide-card">
            <h3>{g.data.title}</h3>
            <p>{g.data.resume || "Fiches de r√©vision compl√®tes"}</p>
          </a>
        ))}
      </div>
    </div>

    <div class="menu-section">
      <div class="section-title rapido-color">
        <span>‚ö°</span> Rapidos
      </div>
      <div class="grid">
        {rapidos.length > 0 ? (
          rapidos.map(r => (
            /* üõ†Ô∏è AJOUT DE LA BASE ICI */
            <a href={`${base}/rapidos/${r.slug.replace('/index', '')}/`} class="card rapido-card">
              <h3>{r.data.title}</h3> 
              <p>Exercices d'√©chauffement & rituels</p>
            </a>
          ))
        ) : (
          <div class="empty-msg">Aucun rapido disponible pour le moment.</div>
        )}
      </div>
    </div>

  </div>
</body>
</html>