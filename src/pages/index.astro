---
// src/pages/index.astro
import { getCollection } from 'astro:content';
import Navbar from '../components/Navbar.astro';
import '../styles/main.css';
import '../styles/pages/home.css';

// RÃ©cupÃ©ration des collections
const guides = await getCollection('guide', ({ id }) => {
  return id.split('/').length === 2 && id.endsWith('index.md');
});
const rapidos = await getCollection('rapidos', ({ id }) => {
  return id.split('/').length === 2 && id.endsWith('index.md');
});

// Tri alphabÃ©tique
const sortContent = (a, b) => a.data.title.localeCompare(b.data.title);

// RÃ©cupÃ©ration de la Base URL (pour GitHub Pages)
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maths974 - Accueil</title>
  <link rel="icon" type="image/svg+xml" href={`${base}/favicon.svg`} />
</head>
<body>
  
  <Navbar title="Accueil" />

  <div class="home-container">
    
    <header class="home-header">
      <h1 class="home-title">Maths974</h1>
      <p class="home-subtitle">Ressources, fiches de rÃ©vision et exercices rapides pour le collÃ¨ge et le lycÃ©e.</p>
    </header>

    <div class="menu-section">
      <div class="section-title guide-color">
        <span>ðŸ“š</span> Guides de Survie
      </div>
      <div class="grid">
        {guides.sort(sortContent).map(g => (
          <a href={`${base}/guide/${g.slug.replace('/index', '')}/`} class="card guide-card">
            
            <div class="card-header-home">
                <h3>{g.data.title}</h3>
                {/* ðŸŸ¢ Badge Niveau Guide */}
                {g.data.niveau && <span class="badge guide">{g.data.niveau}</span>}
            </div>
            
            <p>{g.data.resume || "Fiches de rÃ©vision complÃ¨tes"}</p>
          </a>
        ))}
      </div>
    </div>

    <div class="menu-section">
      <div class="section-title rapido-color">
        <span>âš¡</span> Rapidos
      </div>
      <div class="grid">
        {rapidos.length > 0 ? (
          rapidos.map(r => (
            <a href={`${base}/rapidos/${r.slug.replace('/index', '')}/`} class="card rapido-card">
              
              <div class="card-header-home">
                  <h3>{r.data.title}</h3>
                  {/* ðŸŸ  Badge Niveau Rapido */}
                  {r.data.niveau && <span class="badge rapido">{r.data.niveau}</span>}
              </div>
              
              <p>Exercices d'Ã©chauffement & rituels</p>
            </a>
          ))
        ) : (
          <div class="empty-msg">Aucun rapido disponible pour le moment.</div>
        )}
      </div>
    </div>

  </div>
</body>
</html>

<style>
  /* Styles spÃ©cifiques aux cartes de l'accueil */
  
  .card-header-home {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-2);
    gap: 1rem;
  }

  /* On s'assure que le titre ne prend pas toute la place s'il y a un badge */
  .card-header-home h3 {
    margin: 0;
    font-size: var(--text-xl);
    line-height: 1.2;
  }

  .badge {
    font-size: 0.75rem;
    padding: 0.25rem 0.6rem;
    border-radius: 99px;
    font-weight: 700;
    text-transform: uppercase;
    white-space: nowrap; /* EmpÃªche le badge de se casser */
    flex-shrink: 0;      /* EmpÃªche le badge de rÃ©trÃ©cir */
  }

  /* Couleurs des badges */
  .badge.guide {
    background-color: var(--color-guide-light);
    color: var(--color-guide-primary);
  }

  .badge.rapido {
    background-color: var(--color-rapido-light);
    color: var(--color-rapido-primary);
  }
</style>