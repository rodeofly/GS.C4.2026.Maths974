---
import { getCollection } from 'astro:content';

// On rÃ©cupÃ¨re juste les racines (les niveaux) de chaque collection
const guides = await getCollection('guide', ({ slug }) => slug.split('/').length === 2 && slug.endsWith('/index'));
const rapidos = await getCollection('rapidos', ({ slug }) => slug.split('/').length === 2 && slug.endsWith('/index'));

// Fonction de tri
const sortContent = (a, b) => a.slug.localeCompare(b.slug);
---

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maths974 - Accueil</title>
  <style>
    body { font-family: system-ui; margin: 0; background: #f1f5f9; color: #1e293b; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
    .container { max-width: 900px; width: 100%; padding: 2rem; }
    h1 { text-align: center; color: #0f172a; font-size: 2.5rem; margin-bottom: 3rem; }
    
    .menu-section { margin-bottom: 3rem; }
    .section-title { font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
    .guide-color { color: #0b4f6c; }
    .rapido-color { color: #d97706; }

    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; }
    
    .card {
      background: white;
      padding: 1.5rem;
      border-radius: 0.75rem;
      text-decoration: none;
      color: inherit;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s;
      border: 1px solid transparent;
    }
    .card:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
    
    .guide-card:hover { border-color: #0b4f6c; }
    .rapido-card:hover { border-color: #d97706; }

    .card h3 { margin: 0; font-size: 1.25rem; }
    .card p { margin: 0.5rem 0 0; font-size: 0.9rem; color: #64748b; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Maths974</h1>

    <div class="menu-section">
      <div class="section-title guide-color">
        <span>ðŸ“š</span> Guides de Survie
      </div>
      <div class="grid">
        {guides.sort(sortContent).map(g => (
          <a href={`/guide/${g.slug.replace('/index', '')}/`} class="card guide-card">
            <h3>{g.data.title}</h3>
            <p>{g.data.resume || "Fiches de rÃ©vision complÃ¨tes"}</p>
          </a>
        ))}
      </div>
    </div>

    <div class="menu-section">
      <div class="section-title rapido-color">
        <span>âš¡</span> Rapidos
      </div>
      <div class="grid">
        {rapidos.length > 0 ? rapidos.sort(sortContent).map(r => (
          <a href={`/rapidos/${r.slug.replace('/index', '')}/`} class="card rapido-card">
            <h3>{r.data.title}</h3>
            <p>Exercices d'Ã©chauffement</p>
          </a>
        )) : (
          <p style="color: #64748b; font-style: italic;">Aucun rapido disponible pour le moment.</p>
        )}
      </div>
    </div>

  </div>
</body>
</html>